try{

	$('#session_token').attr('value', '<%= @session_token %>');

	<% # Login screen %>
	<% if @state && @state == 1 %>
	
		$('#flyc_panel').animate({
			width: '350px',
			height: '500px'
		});
		
		$('#primary_messages').replaceWith("\
			You must log in to use Flyc's smart bookmarks. Please login or register below\
		");
		
		$('#content_panel').replaceWith("\
			<div id='content_panel'>\
				\
				<div id='login_panel'>\
					\
					<table>\
						<tr>\
							<td>\
								<span style='font-size: 15pt; padding: .25em 0em .5em 0em;width:200px;font-weight:bold;'>Login</span>\
							</td>\
						</tr>\
						<tr>\
							<td id='login_messages' style='font-size:10pt;'></td>\
						</tr>\
					</table>\
					\
					<table>\
						<tr>\
							<td style='font-size:10pt;'>Email:</td>\
							<td style='font-size:10pt;'><input id=\"email\" type=\"text\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>Password:</td>\
							<td style='font-size:10pt;'><input id=\"password\" type=\"password\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>&nbsp;</td>\
							<td style='font-size:10pt;'>\
								<input name=\"save_login[checked]\" type=\"hidden\" value=\"no\" />\
								<input id='remember_me' type=\"checkbox\" value=\"yes\" name=\"save_login[checked]\"/> Remember me\
							</td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>&nbsp;</td>\
							<td style='font-size:10pt;'><button id=\"btn_login\" style=\"width:50px;height:25px;\" onClick=\"ajax_it('process_login');return false;\">Login</button></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>&nbsp;</td>\
							<td style='text-align:right;font-size:10pt;'><a href=''>Forgot your password?</a></td>\
						</tr>\
					</table>\
					\
					<p><hr/></p>\
					\
				</div>\
				\
				<div id='registration_panel'>\
					\
					<span style='font-size: 15pt; padding: .25em 0em .5em 0em;width:200px;font-weight:bold;'>Register</span>\
					\
					<div id='registration_messages'></div>\
					\
					<table>\
						<tr>\
							<td style='font-size:10pt;'>First Name:</td>\
							<td style='font-size:10pt;'><input id=\"email\" type=\"text\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>Last Name:</td>\
							<td style='font-size:10pt;'><input id=\"email\" type=\"text\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>Email:</td>\
							<td style='text-align:right;font-size:10pt;'><input id=\"email\" type=\"text\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>Password</td>\
							<td style='font-size:10pt;'><input id=\"email\" type=\"text\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>Password Repeat</td>\
							<td style='font-size:10pt;'><input id=\"email\" type=\"text\" size=\"30\"></td>\
						</tr>\
						<tr>\
							<td style='font-size:10pt;'>&nbsp;</td>\
							<td style='font-size:10pt;'><button id=\"btn_register\" style=\"width:50px;height:25px;\" onClick=\"ajax_it('register');\">Register</button></td>\
						</tr>\
					</table>\
					\
					<p><hr/></p>\
				\
				</div>\
				\
				<div id='buttons_panel' style=\"padding:.5em 0em 0em 0em;\">\
					<button id=\"btn_close\" style=\"width:50px;height:25px;\" onClick=\"ajax_it('close'); return false;\">Close</button>\
					<button id=\"btn_post\" style=\"width:90px;height:25px;\" onClick=\"doY(); return false;\">Post It</button>\
				</div>\
			</div>");
				
		//$.throbberShow({parent: $("#site_detected"), image: "http://localhost:3002/images/ajax-loader.gif"});
		
		$("#btn_login").throbber("click", {parent: $("#processing_indicator"), image: "http://localhost:3002/images/ajax-loader.gif"});
		
		$("#content_panel").ready(function() {
		  $.throbberHide({parent: $("#processing_indicator")});
		});
		
	<% # Errors - remain on page, update portions %>
		
	<% elsif @state && @state == 0 %>
	
		$("#login_messages").replaceWith("Errors found in fields!!");
	
		<% if @person_login && @person_login.errors %>
		
			<% @person_login.errors.each do |attr, msg| %>
				
				$("#<%= attr %>").after("<div id=\"field_error\">Error in this field</div>");
				
			<% end %>
			
		<% end %>
		
	<% end %>
	
	$("#content_panel").ready(function() {
	  $.throbberHide({parent: $("#processing_indicator")});
	});

} catch(e){ var ee = e.message || 0; alert('Error: \n\n'+e+'\n'+ee); }