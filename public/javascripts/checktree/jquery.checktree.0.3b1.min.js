(function(jQuery){jQuery.fn.checkTree=function(settings){settings=jQuery.extend({onExpand:null,onCollapse:null,onCheck:null,onUnCheck:null,onHalfCheck:null,onLabelHoverOver:null,onLabelHoverOut:null,labelAction:"expand",debug:false},settings);var $tree=jQuery("ul.tree");var $lis=$tree.find('li');var $checkboxes=$lis.find(":checkbox");$checkboxes.css('display','none');$lis.not(':has(.arrow)').each(function(){jQuery(this).prepend('<div class="arrow"></div><div class="checkbox"></div>');});$tree.find('li > ul').css('display','none');$tree.find('li:has(li) > .arrow').click(function(){var $this=jQuery(this);$this.toggleClass('expanded').toggleClass('collapsed').siblings("ul:first").toggle();if(settings.onExpand&&$this.hasClass('expanded')){settings.onExpand($this.parent());}
else if(settings.onCollapse&&$this.hasClass('collapsed')){settings.onCollapse($this.parent());}}).addClass('collapsed');$tree.find('.checkbox').click(function(){var $this=jQuery(this);$this.toggleClass('checked').removeClass('half_checked').siblings(':checkbox:first').attr('checked',$this.hasClass('checked')?'checked':'');$this.filter('.checked').siblings('ul:first').find('.checkbox:not(.checked)').removeClass('half_checked').addClass('checked').siblings(':checkbox').attr('checked','checked');$this.filter(':not(.checked)').siblings('ul:first').find('.checkbox.checked').removeClass('checked half_checked').siblings(':checkbox').attr('checked','');$this.parents("ul:first").siblings(":checkbox:first").change();if(settings.onCheck&&$this.hasClass('checked')){settings.onCheck($this.parent());}
else if(settings.onUnCheck&&$this.hasClass('checked')==false){settings.onUnCheck($this.parent());}});$checkboxes.change(function(){var $this=jQuery(this);var $checkbox=$this.siblings('.checkbox:first');var any_checked=$this.siblings('ul:first').find(':checkbox:checked:first').length==1;var any_unchecked=$this.siblings('ul:first').find(':checkbox:not(:checked):first').length==1;if(any_checked){$this.attr('checked','checked');if(any_unchecked){$checkbox.addClass('half_checked').removeClass('checked');if(settings.onHalfCheck){settings.onHalfCheck($this.parent());}}
else{$checkbox.addClass('checked').removeClass('half_checked');}}
else{$checkbox.removeClass('checked half_checked');$this.attr('checked','');}});$tree.find('label').click(function(){switch(settings.labelAction){case'expand':jQuery(this).siblings('.arrow:first').click();break;case'check':jQuery(this).siblings('.checkbox:first').click();break;}}).hover(function(){jQuery(this).addClass("hover");if(settings.onLabelHoverOver){settings.onLabelHoverOver(jQuery(this).parent());}},function(){jQuery(this).removeClass("hover");if(settings.onLabelHoverOut){settings.onLabelHoverOut(jQuery(this).parent());}});$tree.clear=function(){$tree.find('.checkbox').removeClass('checked').siblings(':checkbox').attr('checked','');};};})(jQuery);